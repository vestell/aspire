(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1324:function(t,e,r){"use strict";var n=Array.prototype.slice;function l(t){var e,a,r=n.call(arguments,1);switch(r.length){case 1:throw new Error("Not enough forms");case 2:e=t>1?r[1]:r[0];break;default:e=r[(a=t,a%10==1&&a%100!=11?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2)]}return e.replace(/%d/g,t)}t.exports=l,t.exports.noun=l,t.exports.verb=function(t){return n.call(arguments,1)[function(a){if(a>1e6)return 2;a>1e3&&a<1e6&&/000$/.test(a)&&(a/=1e3);return a%10==1&&a%100!=11||/1000$/.test(a.toString())?0:a%10>=2&&a%10<=4&&(a%100<10||a%100>=20)?1:2}(t)].replace(/%d/g,t)}},1327:function(t,e,r){"use strict";var n={props:["labels"]},l=r(30),component=Object(l.a)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.labels.partner||t.labels.dbookPartner||t.labels.youtube||t.labels.twitch||t.labels.gift?r("div",{staticClass:"labels"},[t.labels.partner?r("a-tooltip",[r("template",{slot:"title"},[t._v("\n      Сервер является официальным партнером Discord\n    ")]),t._v(" "),r("div",{staticClass:"label"},[r("img",{attrs:{src:"/icons/partner.png",alt:""}})])],2):t._e(),t._v(" "),t.labels.dbookPartner?r("a-tooltip",[r("template",{slot:"title"},[t._v("\n      Сервер является партнером проекта DiscordBook\n    ")]),t._v(" "),r("div",{staticClass:"label gift"},[r("i",{staticClass:"fas fa-handshake"})])],2):t._e(),t._v(" "),t.labels.gift?r("a-tooltip",[r("template",{slot:"title"},[t._v("\n      Выдаётся награда за голос\n    ")]),t._v(" "),r("div",{staticClass:"label gift"},[r("i",{staticClass:"fas fa-gift"})])],2):t._e(),t._v(" "),t.labels.youtube?r("a-tooltip",[r("template",{slot:"title"},[t._v("\n      На сервере есть ютуберы\n    ")]),t._v(" "),r("div",{staticClass:"label youtube"},[r("i",{staticClass:"fab fa-youtube"})])],2):t._e(),t._v(" "),t.labels.twitch?r("a-tooltip",[r("template",{slot:"title"},[t._v("\n      На сервере есть стримеры\n    ")]),t._v(" "),r("div",{staticClass:"label twitch"},[r("i",{staticClass:"fab fa-twitch"})])],2):t._e()],1):t._e()}),[],!1,null,null,null);e.a=component.exports},1337:function(t,e,r){"use strict";r.r(e);r(318),r(151),r(216);function n(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r(97),r(60),r(664),r(67);var l=r(317),o=r(1324),c=r(1327),v={props:["review"],computed:{userImageSet:function(){return{src:this.authorAvatar,error:"../img/dlogo.png",loading:"../img/dlogo.png"}},authorAvatar:function(){return"https://cdn.discordapp.com/avatars/".concat(this.review.author.discord_id,"/").concat(this.review.author.avatar)},fullText:function(){return this.review.review_text?this.review.review_text.split("\n").join("<br />"):null},image:function(){return this.review.guild.image?"/uploads/".concat(this.review.guild.fullImage):"/img/noimage.jpg"}}},d=r(30),_=Object(d.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"review"},[r("div",{staticClass:"content"},[r("div",{staticClass:"stars"},[r("div",{staticClass:"star"},[r("div",{staticClass:"name"},[t._v("Работа администрации")]),t._v(" "),r("a-rate",{attrs:{allowHalf:"",disabled:"",value:t.review.admin_star}})],1),t._v(" "),r("div",{staticClass:"star"},[r("div",{staticClass:"name"},[t._v("Дружелюбность участников")]),t._v(" "),r("a-rate",{attrs:{allowHalf:"",disabled:"",value:t.review.friendship_star}})],1),t._v(" "),r("div",{staticClass:"star"},[r("div",{staticClass:"name"},[t._v("Количество развлечений")]),t._v(" "),r("a-rate",{attrs:{allowHalf:"",disabled:"",value:t.review.events_count_star}})],1),t._v(" "),r("div",{staticClass:"star"},[r("div",{staticClass:"name"},[t._v("Качество развлечений")]),t._v(" "),r("a-rate",{attrs:{allowHalf:"",disabled:"",value:t.review.events_quality_star}})],1)]),t._v(" "),r("div",{staticClass:"text",domProps:{innerHTML:t._s(t.fullText)}}),t._v(" "),r("div",{class:"reccomend "+(1==t.review.recommend?"like":"dislike")},[t._v("\n      "+t._s(t.review.author.name)+"\n      "+t._s(1==t.review.recommend?"рекомендует этот сервер":"не рекомендует этот сервер")+"\n    ")]),t._v(" "),r("div",{staticClass:"header"},[r("div",{staticClass:"author"},[r("div",{staticClass:"avatar"},[r("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.userImageSet,expression:"userImageSet"}]})]),t._v(" "),r("div",{staticClass:"name"},[r("div",[t._v(t._s(t.review.author.name))]),t._v(" "),r("div",[t._v("#"+t._s(t.review.author.tag))])])])])])])}),[],!1,null,null,null).exports,f={components:{Labels:c.a,Review:_},asyncData:function(t){var e,r,n,o,c,v,d,_;return regeneratorRuntime.async((function(f){for(;;)switch(f.prev=f.next){case 0:return e=t.app,r=t.params,n=t.store,o=t.redirect,f.next=3,regeneratorRuntime.awrap(e.apolloProvider.defaultClient.query({query:l.getGuild,variables:{guild_id:r.id}}));case 3:if(c=f.sent,v=c.data.guild){f.next=7;break}return f.abrupt("return",o("/"));case 7:return d=n.getters.getTags,_=v.tags.map((function(t){return d.find((function(e){return e.id==t}))})),f.abrupt("return",{guild:v,tags:d,selectedTags:_,reviewPage:1,busy:!1});case 10:case"end":return f.stop()}}))},data:function(){return{loading:!1,busy:!1}},head:function(){return{title:"".concat(this.guild.name," - DiscordBook"),meta:[{name:"description",hid:"description",content:this.guild.description},{name:"og:title",hid:"og:title",content:"".concat(this.guild.name," - DiscordBook")},{name:"og:description",hid:"og:description",content:this.guild.description},{name:"og:image",hid:"og:image",content:this.guild.icon}]}},methods:{vote:function(){var t,e;return regeneratorRuntime.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.loading){r.next=2;break}return r.abrupt("return");case 2:if(this.$store.state.user.id){r.next=4;break}return r.abrupt("return",this.$showError("Только авторизованные пользователи могут голосовать"));case 4:return this.loading=!0,r.prev=5,r.next=8,regeneratorRuntime.awrap(this.$apollo.mutate({mutation:l.voteGuild,variables:{guild_id:this.guild.guild_id}}));case 8:t=r.sent,t.data,this.$showSuccess("Спасибо! Ваш голос учтен"),this.guild.rating++,r.next=18;break;case 14:r.prev=14,r.t0=r.catch(5),e=r.t0.message.replace("GraphQL error: ",""),this.$showError(e);case 18:this.loading=!1;case 19:case"end":return r.stop()}}),null,this,[[5,14]])},loadMore:function(t){var e=this;this.reviews.reviews.length!=this.reviews.count?(this.reviewPage++,this.busy=!0,this.$apollo.queries.reviews.fetchMore({variables:{guild_id:this.$route.params.id,page:this.reviewPage},updateQuery:function(t,r){var l=r.fetchMoreResult,o=[].concat(n(t.reviews.reviews),n(l.reviews.reviews));return e.busy=!1,{reviews:{__typename:t.reviews.__typename,count:t.reviews.count,reviews:o}}}})):this.busy=!0},scroll:function(){var t=this;window.onscroll=function(){window.innerHeight+window.scrollY>=document.body.offsetHeight-200&&!t.busy&&t.loadMore()}}},mounted:function(){this.scroll()},computed:{votes:function(){return Object(o.noun)(this.guild.rating,"голос","голоса","голосов")},image:function(){return this.guild.image?"/uploads/".concat(this.guild.fullImage):"/img/noimage.jpg"},icon:function(){this.guild.icon.includes("/a_");return this.guild.icon},getColor:function(){switch(this.guild.position){case 1:return"color:#edb12d";case 2:return"color:#c0c0c0";case 3:return"color:#cd7f32 ";default:return"color:#5c5c5c"}},fullDesc:function(){return this.guild.full_description?this.guild.full_description.split("\n").join("<br />"):null}},apollo:{reviews:{query:l.getServerReviews,variables:function(){return{guild_id:this.$route.params.id}}}}},h=Object(d.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"server"},[r("div",{staticClass:"wrapper"},[r("div",{staticClass:"card"},[r("div",{staticClass:"avatar",style:{backgroundImage:"url("+t.icon+"), url('../img/noimage.jpg')"}}),t._v(" "),r("div",{staticClass:"image",style:{backgroundImage:"url("+t.image+"), url('../img/noimage.jpg')"}}),t._v(" "),r("div",{staticClass:"content"},[r("div",{staticClass:"left"},[r("h1",{staticClass:"name"},[t._v(t._s(t.guild.name))]),t._v(" "),r("noindex",[r("div",{staticClass:"dotsPanel"},[r("div",{staticClass:"forDot star"},[r("i",{staticClass:"fas fa-star"}),t._v(" "),r("span",{staticClass:"text"},[t._v(t._s(parseInt(t.guild.rating).toLocaleString())+" "+t._s(t.votes))])]),t._v(" "),r("div",{staticClass:"forDot"},[r("div",{staticClass:"dot"}),t._v(" "),r("div",{staticClass:"text"},[t._v(t._s(parseInt(t.guild.members_count).toLocaleString())+" участников")])]),t._v(" "),r("div",{staticClass:"forDot"},[r("div",{staticClass:"dot voice"}),t._v(" "),r("div",{staticClass:"text"},[t._v(t._s(parseInt(t.guild.voice_count).toLocaleString())+" в войсе")])])])]),t._v(" "),r("noindex",[r("Labels",{attrs:{labels:t.guild.labels}})],1),t._v(" "),r("noindex",[r("div",{staticClass:"subtitle"},[t._v("Тэги:")]),t._v(" "),r("div",{staticClass:"tags"},t._l(t.guild.tags,(function(e){return r("div",{key:e,staticClass:"tag"},[t._v(t._s(t.$store.getters.getTagName(e)))])})),0)]),t._v(" "),r("div",{staticClass:"subtitle"},[t._v("Краткое описание:")]),t._v(" "),r("div",{staticClass:"description"},[t._v(t._s(t.guild.description))]),t._v(" "),t.guild.full_description&&t.guild.full_description.length>0?r("div",{staticClass:"subtitle"},[t._v("Подробнее:")]):t._e(),t._v(" "),r("div",{staticClass:"fullDesc",domProps:{innerHTML:t._s(t.fullDesc)}})],1),t._v(" "),r("div",{staticClass:"right"},[r("noindex",[r("a-button",{staticClass:"voteButton",attrs:{type:"primary",loading:t.loading},on:{click:t.vote}},[r("span",{staticStyle:{"font-weight":"bold","font-size":"14px"}},[t._v("Проголосовать")])]),t._v(" "),r("nuxt-link",{staticClass:"joinButton voteButton",staticStyle:{"margin-top":"15px"},attrs:{to:{path:"../reviews/add",query:{server:t.guild.guild_id}},tag:"a"}},[t._v("Написать обзор")]),t._v(" "),r("a",{staticClass:"joinButton",attrs:{href:t.guild.invite,target:"_BLANK"}},[t._v("Зайти на сервер")])],1)],1)])])])]),t._v(" "),t.reviews&&t.reviews.reviews.length?r("div",{staticClass:"heading",staticStyle:{"padding-top":"30px"}},[r("h1",{staticClass:"text"},[t._v("Обзоры сервера ("+t._s(t.reviews.count)+")")])]):t._e(),t._v(" "),r("div",{staticClass:"wrapper"},[t.reviews&&t.reviews.reviews.length?r("div",{staticClass:"reviews"},t._l(t.reviews.reviews,(function(t){return r("Review",{key:t.id,attrs:{review:t}})})),1):t._e()])])}),[],!1,null,null,null);e.default=h.exports}}]);